<div class="bookstore-container" (click)="closeDropdownOnOutsideClick($event)">
  <!-- Header con Bootstrap - ESTILO FIGMA -->
  <header class="custom-header sticky-top">
    <div class="container-fluid">
      <div class="row align-items-center py-3">
        
        <!-- Logo -->
        <div class="col-auto">
          <div class="logo-container">
            <img src="assets/images/logo.png" alt="Logo" class="logo-img" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="logo-placeholder" style="display: none;">LOGO</div>
          </div>
        </div>

        <!-- Buscador Centrado -->
        <div class="col d-flex justify-content-center">
          <div class="search-container-figma">
            <input 
              type="text" 
              class="search-input-figma"
              [(ngModel)]="searchTerm"
              placeholder=""
              (keyup.enter)="onSearch()"
            >
            <button 
              class="search-btn-figma" 
              type="button"
              (click)="onSearch()"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19S2 15.194 2 10.5 5.806 2 10.5 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Navegaci칩n -->
        <div class="col-auto">
          <div class="d-flex align-items-center" style="gap: 2rem;">
            <!-- Categor칤as con dropdown -->
            <div class="position-relative dropdown-container">
              <button class="nav-item-figma" (click)="toggleCategoriesDropdown($event)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 7H8V12H3V7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13 7H18V12H13V7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13 17H18V22H13V17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 17H8V22H3V17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Categor칤as</span>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" 
                     [style.transform]="showCategoriesDropdown ? 'rotate(180deg)' : 'rotate(0deg)'"
                     [style.transition]="'transform 0.3s ease'">
                  <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>

              <!-- Dropdown de categor칤as -->
              <div class="categories-dropdown-figma" 
                   [class.show]="showCategoriesDropdown"
                   *ngIf="showCategoriesDropdown">
                
                <button 
                  class="dropdown-item-figma" 
                  [class.active]="selectedCategory === 'Todas'"
                  (click)="selectCategory('Todas')"
                >
                  Todas las categor칤as
                </button>
                
                <button 
                  class="dropdown-item-figma" 
                  *ngFor="let category of categories"
                  [class.active]="selectedCategory === category"
                  (click)="selectCategory(category)"
                >
                  {{category}}
                </button>
              </div>
            </div>
            
            <button class="nav-item-figma position-relative" (click)="goToSaved()">
              <!-- Mismo 칤cono bookmark que en las tarjetas -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 21L12 16L5 21V5C5 4.46957 5.21071 3.96086 5.58579 3.58579C5.96086 3.21071 6.46957 3 7 3H17C17.5304 3 18.0391 3.21071 18.4142 3.58579C18.7893 3.96086 19 4.46957 19 5V21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Guardados</span>
              <span *ngIf="savedItems > 0" class="badge-figma">{{savedItems}}</span>
            </button>
            
            <button class="nav-item-figma position-relative" (click)="goToCart()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V16.5M9 19.5C9.8 19.5 10.5 20.2 10.5 21S9.8 22.5 9 22.5 7.5 21.8 7.5 21 8.2 19.5 9 19.5ZM20 19.5C20.8 19.5 21.5 20.2 21.5 21S20.8 22.5 20 22.5 18.5 21.8 18.5 21 19.2 19.5 20 19.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Mi carrito</span>
              <span *ngIf="cartItems > 0" class="badge-figma">{{cartItems}}</span>
            </button>
            
            <div class="position-relative">
              <button class="profile-btn-figma" (click)="toggleProfileDropdown($event)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>

              <!-- Dropdown del perfil -->
              <div class="profile-dropdown-figma" 
                   [class.show]="showProfileDropdown"
                   *ngIf="showProfileDropdown">
                
                <div class="profile-header">
                  <div class="profile-avatar">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                </div>
                
                <button class="profile-dropdown-item" (click)="goToProfile()">
                  Mi cuenta
                </button>
                
                <button class="profile-dropdown-item" (click)="goToOrders()">
                  Mis pedidos
                </button>
                
                <div class="profile-divider"></div>
                
                <button class="profile-dropdown-item logout" (click)="goToLogin()">
                  Cerrar sesi칩n
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Banner principal con Bootstrap -->
  <section class="hero-section my-4">
    <div class="container">
      <div class="row align-items-center hero-banner-custom p-4 rounded-4">
        <div class="col-md-8">
          <h1 class="display-4 fw-bold text-custom-dark mb-3">
            LOS LIBROS, COMO BUENOS AMIGOS:
          </h1>
          <p class="banner-subtitle">
            siempre est치n cuando los necesitas.
          </p>
        </div>
        <div class="col-md-4 text-center">
          <div class="books-illustration">
            游닄游닀游늽游닁游닂游닃
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Indicador de categor칤a seleccionada - NUEVO DISE칌O -->
  <section class="category-title" *ngIf="selectedCategory !== 'Todas'">
    <div class="container">
      <div class="category-header">
        <h2 class="category-name">{{selectedCategory}}</h2>
        <span class="books-count">{{books.length}} libro(s)</span>
      </div>
    </div>
  </section>

  <!-- Grid de libros con Bootstrap -->
  <section class="books-section">
    <div class="container">
      <div class="row g-4" *ngIf="books.length > 0; else noBooks">
        <div class="col-12 col-sm-6 col-lg-4" *ngFor="let book of books">
          <div class="card book-card-custom h-100">
            <div class="position-relative">
              <img [src]="book.image" [alt]="book.title" class="card-img-top book-img-custom">
              
              <!-- Bot칩n de guardados con estado din치mico -->
              <button class="btn save-btn-custom position-absolute" 
                      [ngClass]="{'saved-active': isBookSaved(book.id)}"
                      (click)="addToSaved(book)">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19 21L12 16L5 21V5C5 4.46957 5.21071 3.96086 5.58579 3.58579C5.96086 3.21071 6.46957 3 7 3H17C17.5304 3 18.0391 3.21071 18.4142 3.58579C18.7893 3.96086 19 4.46957 19 5V21Z" 
                        [attr.fill]="isBookSaved(book.id) ? '#6A93B2' : 'none'"
                        stroke="currentColor" 
                        stroke-width="2" 
                        stroke-linecap="round" 
                        stroke-linejoin="round"/>
                </svg>
              </button>
              
              <!-- Badge del tipo de libro -->
              <div class="book-type-badge" 
                   [ngClass]="{
                     'badge-venta': book.type === 'Venta',
                     'badge-donacion': book.type === 'Donaci칩n',
                     'badge-intercambio': book.type === 'Intercambio'
                   }">
                {{book.type}}
              </div>
            </div>
            
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-custom-dark mb-2">{{book.title}}</h5>
              <p class="card-text text-muted mb-2">{{book.author}}</p>
              <p class="card-text book-description mb-3">{{book.description}}</p>
              
              <!-- Precio solo para ventas -->
              <div class="price-section mb-3" *ngIf="book.type === 'Venta'">
                <span class="price-label">Precio:</span>
                <span class="price-amount">${{book.price}}</span>
              </div>
              
              <div class="mt-auto">
                <button 
                  class="btn btn-block w-100"
                  [ngClass]="{
                    'btn-custom-venta': book.type === 'Venta',
                    'btn-custom-donacion': book.type === 'Donaci칩n',
                    'btn-custom-intercambio': book.type === 'Intercambio'
                  }"
                  (click)="getButtonAction(book)"
                >
                  {{getButtonText(book.type)}}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay libros -->
      <ng-template #noBooks>
        <div class="text-center py-5">
          <div class="mb-4">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-muted">
              <path d="M4 19.5C4 18.837 4.26339 18.2011 4.73223 17.7322C5.20107 17.2634 5.83696 17 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.5 2H20V22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 7H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 11H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h4 class="text-muted">No se encontraron libros</h4>
          <p class="text-muted">No hay libros disponibles en la categor칤a "{{selectedCategory}}"</p>
          <button class="btn btn-primary" (click)="selectCategory('Todas')">Ver todos los libros</button>
        </div>
      </ng-template>
    </div>
  </section>
</div>